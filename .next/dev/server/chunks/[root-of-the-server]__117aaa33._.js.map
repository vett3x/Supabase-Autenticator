{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///F:/proyectos-ia/Supabase-Autenticator/src/proxy.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport type { NextRequest } from \"next/server\";\nimport { jwtVerify } from \"jose\";\n\nconst JWT_SECRET = new TextEncoder().encode(\n  process.env.JWT_SECRET || \"default_secret_key_change_me_in_production\"\n);\n\nexport async function proxy(request: NextRequest) {\n  const token = request.cookies.get(\"auth_token\")?.value;\n\n  // Si estamos en la página de login y ya tenemos token, ir al dashboard\n  if (request.nextUrl.pathname === \"/\" || request.nextUrl.pathname === \"/api/auth/login\") {\n    if (token) {\n      try {\n        await jwtVerify(token, JWT_SECRET);\n        return NextResponse.redirect(new URL(\"/dashboard\", request.url));\n      } catch (e) {\n        // Token inválido, dejar pasar al login\n      }\n    }\n    return NextResponse.next();\n  }\n\n  // Para cualquier otra página (como /dashboard o proxy), verificar token\n  if (!token) {\n    return NextResponse.redirect(new URL(\"/\", request.url));\n  }\n\n  try {\n    await jwtVerify(token, JWT_SECRET);\n    return NextResponse.next();\n  } catch (e) {\n    return NextResponse.redirect(new URL(\"/\", request.url));\n  }\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     */\n    \"/((?!_next/static|_next/image|favicon.ico).*)\",\n  ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CACzC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAGrB,eAAe,MAAM,OAAoB;IAC9C,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe;IAEjD,uEAAuE;IACvE,IAAI,QAAQ,OAAO,CAAC,QAAQ,KAAK,OAAO,QAAQ,OAAO,CAAC,QAAQ,KAAK,mBAAmB;QACtF,IAAI,OAAO;YACT,IAAI;gBACF,MAAM,IAAA,oKAAS,EAAC,OAAO;gBACvB,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;YAChE,EAAE,OAAO,GAAG;YACV,uCAAuC;YACzC;QACF;QACA,OAAO,8IAAY,CAAC,IAAI;IAC1B;IAEA,wEAAwE;IACxE,IAAI,CAAC,OAAO;QACV,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;IACvD;IAEA,IAAI;QACF,MAAM,IAAA,oKAAS,EAAC,OAAO;QACvB,OAAO,8IAAY,CAAC,IAAI;IAC1B,EAAE,OAAO,GAAG;QACV,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;IACvD;AACF;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;KAKC,GACD;KACD;AACH"}}]
}